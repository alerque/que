#!/bin/sh

set -x

# Error out of script if _anything_ goes wrong
set -e

# Make sure we have the tools (otherwise we should be running a system init routine instead)
which mr > /dev/null
which vcsh > /dev/null

# Clone the very base bit in
cd $HOME

if [ ! -d .config/vcsh/repo.d/que.git ]; then
	if [ ! -f ./bin/questrap ]; then
		vcsh clone git@github.com:alerque/que.git
	else
		echo "not able to handle checkout in top of existing home dir yet"
		exit
		git clone --no-checkout git@github.com:alerque/que.git que.tmp
		mv que.tmp/.git .
		rmdir que.tmp
		git reset HEAD
	fi
else
	mr up
	#vcsh run que git pull
fi

case $HOSTNAME in
	lemur|pars|laylek)
		# Desktop stuff
		ln -s .config/mr/{available.d,repo.d}/awesome.vcsh
		#ln -s .config/mr/{available.d,repo.d}/urxvt.vcsh
		#ln -s .config/mr/{available.d,repo.d}/xorg.vcsh
		;;
	camelion)
		# Server stuff
		;;
esac

exit

## old version....

TMPDIR=$(mktemp -d $TMPDIR/XXXXXX)

# This package is for $HOME
cd

# TODO: install pre-requisits
which git || exit

git clone https://github.com/alerque/que.git $TMPDIR
rsync -avb $TMPDIR/ $HOME/ 
rm -rf $TMPDIR

#curl -#L https://github.com/alerque/que/tarball/master |
#	tar -xzv --strip-components 1
